# 11

## 문제

```
$pat="/[1-3][a-f]{5}_.*122.199.199.70.*\tp\ta\ts\ts/";

if(preg_match($pat,$_GET[val])) { echo("Password is ????"); }
```

val값에 pat 정규표현식에 만족하는 값을 넣으면 문제를 해결할 수 있다.

## 풀이

### regex

간단하게 패턴 매칭의 방식이라고 생각하면 된다. 단지 처음 보면 패턴 매칭보다 암호에 가까워 보일수 있다.

PHP는 `POSIX`와 `Perl` 두 가지 스타일의 정규 표현식을 지원한다. [PHP 매뉴얼](http://php.net/manual/kr/ref.regex.php)을 보면 `POSIX` 스타일은 `PHP 5.3.0`때 부터 사용하지 말라고 권고를 하고 있고 `PHP 7.0.0`부터는 아예 삭제되었다고 한다.

#### POSIX

`POSIX` 스타일을 지원하는 함수는 다음과 같다.

- `ereg_replace` : 정규표현식 치환함수
- `ereg` : 정규표현식 탐색함수
- `eregi_replace` : 대소문자 구별없는 정규표현식 치환함수
- `eregi` : 대소문자 구별없는 정규표현식 탐색함수
- `split` : 정규표현식으로 문자를 찾아 구분자로 사용해 문자열을 배열로 나누는 함수
- `spliti` : 정규표현식으로 대소문자 구별없이 문자를 찾아 구분자로 사용해 문자열을 배열로 나누는 함수
- `sql_regcase` : 대소문자 구별 없이 입력값을 찾을 수 있는 정규표현식을 생성하는 함수

아래 패턴은 단위로 맞추는 패턴이다. (전체 문자열에 적용되는 패턴이 아님)

- `^` 문자열의 시작을 의미한다.
- `$` 문자열의 끝을 의미한다.
- `n?` n이 없거나 한번만 나오는걸 의미한다.
- `n*` n이 없거나 한번 이상 나오는걸 의미한다.
- `n+` n이 연속으로 한번 이상 나오는걸 의미한다.
- `n{2}` n이 딱 두번 나온다. 그러니 여기선 nn이 된다.
- `n{2,}` n이 두번 이상 나온다.
- `n{2,4}` n이 두번 이상 네번 이하로 나온다.
- `.` 아무 문자 하나가 대응된다.
- `()` 괄호는 패턴을 묶을 때 사용된다.
- `(.*)` 위 패턴을 응용한 사례다. `.`이 없거나 한번 이상이므로 아무런 문자열에 대응된다!
- `(n|a)` n또는 a를 의미한다.
- `[1-6]` 1부터 6까지 숫자 문자 집합중 하나를 의미한다.
- `[c-h]` c부터 h까지 소문자 집합중 하나를 의미한다.
- `[D-M]` D부터 M까지 대문자 집합중 하나를 의미한다.
- `[^a-z]` a부터 z까지 소문자 집합이 **아닌** 문자 하나를 의미한다.
    - `^`가 웃긴게 패턴 맨 앞에 나오는게 아니면 다른 의미를 가지게 된다. `[]`로 표현되는 범위식의 맨 앞에 나오면 그 범위를 부정하는 의미가 되고, 범위식 맨 앞이 아니라면 그냥 `^` 문자 그대로를 의미한다.
- `[_4^a-zA-Z]` _ (underscore), 4, 알파벳 소문자 대문자 집합 중 하나를 의미한다.

아래는 메타문자집합이다. 모두 범위 중 한 문자를 뜻하는 `[]`와 같이 쓰인다.

- `[:digit:]`   숫자 (0부터 9까지)
- `[:alnum:]`   Alphanumeric 문자집합 (숫자 + 알파벳 대소문자) 
- `[:alpha:]`   알파벳 대소문자 
- `[:blank:]`   Space와 TAB문자
- `[:punct:]`   구두 문자 `.` `,` `"` `'` `?` `!` `;` `:`
- `[:print:]`   출력 가능한 문자 
- `[:space:]`   Space 
- `[:upper:]`   알파벳 대문자 
- `[:lower:]`   알파벳 소문자

#### Perl

`Perl` 스타일을 지원하는 함수는 다음과 같다.

- `preg_filter` — Perform a regular expression search and replace
- `preg_grep` — 정규표현식으로 찾은 부분의 배열을 반환하는 함수
- `preg_last_error` — 정규표현식 실행했을 때 마지막으로 발생한 에러코드를 반환하는 함수
- `preg_match_all` — 전역 정규 표현식 탐색
- `preg_match` — 정규표현식 탐색함수
- `preg_quote` — 정규 표현식 문자를 인용
- `preg_replace_callback_array` — Perform a regular expression search and replace using callbacks
- `preg_replace_callback` — 콜백을 이용한 정규 표현식 검색과 치환을 수행
- `preg_replace` — 정규표현식 치환함수
- `preg_split` — 정규표현식 분리함수

아래 패턴은 단위로 맞추는 패턴이다. (전체 문자열에 적용되는 패턴이 아님)

- `^` 문자열의 시작을 의미한다.
- `$` 문자열의 끝을 의미한다.
- `[abc]` a, b, c중 한 문자를 의미한다.
- `[^abc]` a, b, c를 제외한 아무 문자 하나를 의미한다.
- `[a-z]` a부터 z까지 중 문자 하나를 의미한다.
- `[a-zA-Z]` a부터 z까지 또는 A부터 Z까지 중 문자 하나를 의미한다.
- `.` 아무 문자 하나를 의미한다.
- `n?` n이 없거나 한번만 나오는걸 의미한다.
- `n*` n이 없거나 한번 이상 나오는걸 의미한다.
- `n+` n이 연속으로 한번 이상 나오는걸 의미한다.
- `n{2}` n이 딱 두번 나온다. 그러니 여기선 nn이 된다.
- `n{2,}` n이 두번 이상 나온다.
- `n{2,4}` n이 두번 이상 네번 이하로 나온다.

아래 옵션은 패턴 전체에 적용된다.

- `/i` 대소문자 구별 없음
- `/m` `.`이 New-Line 문자와 매칭되게 만든다
- `/x` 정규표현식 내부의 공백문자를 무시한다.

### 그래서 문제가 뭐라고요?

```php
$pat="/[1-3][a-f]{5}_.*122.199.199.70.*\tp\ta\ts\ts/"
```

이 패턴에 맞는 문자열을 생성해 보자.

- `[1-3]` 1부터 3까지 숫자 문자 하나
- `[a-f]{5}` a부터 f까지 소문자 집합 문자로 5문자
- `_`
- `.*` 아무 문자인데 없어두 되니까 생략
- `122.199.199.70` 사이사이 점들에 아무 문자나 들어가도 되니 그냥 두자
- `.*` 생략
- `\tp\ta\ts\ts` 딱 이대로 집어넣으면 된다.

`1abcde_122.199.199.70\tp\ta\ts\ts` 이렇게 패턴에 맞는 문자열을 생성했다.

### 뒷북

쉽게 쉽게 가고 싶으면 온라인에 [정규표현식 실시간으로 맞춰주는 툴](https://www.phpliveregex.com/)이 있으니 그걸 쓰자.

참고로 `\t`는 `Alt+9(Numpad)`를 누르면 입력할 수 있다.

## 레퍼런스

- [[PHP] 4장 문자열 연산과 정규 표현식(2) - 웹 프로그래밍](https://opentutorials.org/course/779/4935)
- [PHP: POSIX Regex 함수 목록 - Manual](http://php.net/manual/kr/ref.regex.php)
- [PHP: PCRE 함수 목록 - Manual](http://php.net/manual/kr/ref.pcre.php)